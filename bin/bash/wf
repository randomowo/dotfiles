#!/bin/bash
# wifi manager by netctl utility
# by randomowo

device=$(ip link | grep -oE 'w\w+')

on() {
	off
	ipDown
	list=($(netctl list))
	echo "Choose network:"
	for (( netIndex=0; netIndex<${#list[@]}; netIndex++ )); do
		echo -e "\t$netIndex ${list[$netIndex]}"
	done
	read -p "Network: " netInd
	if [[ -n $netInd ]] && (( $netInd > ${#list[@]} )); then
		echo "wrong input"
		exit 1
	fi
	sudo netctl start "${list[netInd]}"
}

off() {
	sudo netctl stop-all
	ipUp
	echo "wifi turned off"
}

ipDown() {
	ipstat=$(ip link | grep -E "$device.*" | grep -oE "UP|DOWN" | sed -n 1p)
	if [[ $ipstat == "UP" ]]; then sudo ip link set dev $device down; fi
}

ipUp() {
	sudo ip link set dev "$device" up
}

ipRes() {
	ipDown	
	ipUp
}

new() {
	sudo wifi-menu
}

case $1 in
	"on")
		ipRes
		on;;
	"off")
		ipDown
		off;;
	"new")
		ipDown	
		new;;
	*)
		echo "wrong input"
		exit 1;;
esac

exit 0
