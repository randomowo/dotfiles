#!/bin/zsh

getstats(){
    batstat=()
    IFS="; " read -r batstat <<< $(pmset -g batt | grep -Eo '[1]?[0-9]?[0-9]\%.*')
    echo ${batstat[@]}
}

check_battery_status(){
    batstat=($(getstats))
    stat=$batstat[2]
    if [[ $stat =~ "charge" ]]; then
	echo -n "\U26A1"
    elif [[ $stat =~ "discharging" ]]; then
	echo -n "\U1F44C"
    fi
}

color_persentage(){
    batstat=($(getstats))
    per=${batstat[1]:0:-2}
    if (( $per >= 70 )); then
	echo -n "$(tput setaf 2)$per $(tput setaf 0)"
    elif (( $per < 70 )) && (( $per >= 35 )); then
	echo -n "$(tput setaf 3)$per $(tput setaf 0)"
    elif (( $pet < 35 )); then
	echo -n "$(tput setaf 1)$per $(tput setaf 0)"
    fi
}

rem_time(){
    batstat=($(getstats))
    rem=$batstat[3]
    if [[ $batstat[2] =~ "charged" ]] || [[ $rem =~ "no" ]]; then
	echo -n ""
    else
	echo -n "$(tput setaf 3)$rem $(tput setaf 0)"
    fi
}

if [[ -z "$1" ]]; then
    exit 0
fi
if (( $1 == 1 )); then
    check_battery_status
elif (( $1 == 2 )); then
    color_persentage
elif (( $1 == 3 )); then
    rem_time
elif (( $1 == 0 )); then
    check_battery_status
    echo -n " "
    color_persentage
    echo -n ""
    rem_time
fi
